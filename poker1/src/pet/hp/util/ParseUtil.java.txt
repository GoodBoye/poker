package pet.hp.util;

import java.awt.Dimension;
import java.io.*;
import java.util.*;

import javax.swing.JFrame;

import pet.hp.Parser;
import pet.hp.Hand;
import pet.hp.impl.PSParser;
import pet.ui.gr.*;

public class ParseUtil {

	public static void main(String[] args) {
		try {
			Parser p = ParseUtil.parse();
			History his = new History();
			for (Hand h : p.getHands()) {
				his.nextHand(h);
			}
			//printMostPopular(his);
			List<GraphData> data = Bankroll.getBankRoll(p, "tawvx", "Omaha Pot Limit ($0.01/$0.02 USD)");

			JFrame f = new JFrame();
			f.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
			Graph g = new Graph(data, Bankroll.nf);
			g.setPreferredSize(new Dimension(800,600));
			f.setContentPane(g);
			f.pack();
			f.show();
		} catch (Exception e) {
			e.printStackTrace(System.out);
		}
	}

	public static Parser parse() throws Exception {
		PSParser p = new PSParser();
		String dirname = "/Users/alex/Library/Application Support/PokerStars/HandHistory/tawvx";
		File dir = new File(dirname);
		long t = System.nanoTime();
		List<File> files = new ArrayList<File>();
		for (File f : dir.listFiles()) {
			if (p.isHistoryFile(f.getName())) {
				files.add(f);
			}
		}

		for (File f : files) {
			//System.out.println("file " + f);
			BufferedReader br = new BufferedReader(new InputStreamReader(new FileInputStream(f), "UTF-8"));
			int lineno = 0;
			String line;
			while ((line = br.readLine()) != null) {
				lineno++;
				try {
					p.parseLine(line);
				} catch (Exception e) {
					System.out.println();
					System.out.println(f);
					System.out.println("line " + lineno + ":");
					System.out.println(line);
					throw e;
				}
			}
			br.close();
		}

		System.out.println("took " + ((System.nanoTime() - t) / 1000000000.0) + " secs");

		/*
			ObjectOutputStream os = new ObjectOutputStream(new FileOutputStream("data"));
			os.writeObject(p);
			os.close();
			File f = new File("data");
			System.out.println("wrote file " + f + " size " + f.length());
		 */

		return p;
	}



}
